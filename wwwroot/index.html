<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Chat</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        #messages { border: 1px solid #ccc; height: 400px; overflow-y: scroll; padding: 10px; margin-bottom: 10px; }
        .message { margin: 5px 0; padding: 5px; }
        .system { color: #666; font-style: italic; }
        .user { color: #0066cc; }
        #input-area { display: flex; gap: 10px; }
        #messageInput { flex: 1; padding: 10px; }
        button { padding: 10px 20px; background: #0066cc; color: white; border: none; cursor: pointer; }
        button:hover { background: #0052a3; }
        #status { padding: 10px; margin-bottom: 10px; border-radius: 5px; }
        .connected { background: #d4edda; color: #155724; }
        .disconnected { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>WebSocket Chat Room</h1>
    <div id='status' class='disconnected'>Disconnected</div>
    <div id='messages'></div>
    <div id='input-area'>
        <input type='text' id='messageInput' placeholder='Type your message...' />
        <button onclick='sendMessage()'>Send</button>
    </div>

    <script>
        let ws;
        const messagesDiv = document.getElementById('messages');
        const messageInput = document.getElementById('messageInput');
        const statusDiv = document.getElementById('status');

        function connect() {
            ws = new WebSocket('ws://' + window.location.host + '/ws');
            
            ws.onopen = () => {
                addMessage('Connected to server', 'system');
                statusDiv.textContent = 'Connected';
                statusDiv.className = 'connected';
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                addMessage(`${data.sender}: ${data.message}`, 'user');
            };
            
            ws.onclose = () => {
                addMessage('Disconnected from server', 'system');
                statusDiv.textContent = 'Disconnected';
                statusDiv.className = 'disconnected';
                setTimeout(connect, 3000);
            };
            
            ws.onerror = (error) => {
                addMessage('Error: ' + error, 'system');
            };
        }

        function sendMessage() {
            if (ws.readyState === WebSocket.OPEN && messageInput.value.trim()) {
                ws.send(messageInput.value);
                messageInput.value = '';
            }
        }

        function addMessage(text, className) {
            const div = document.createElement('div');
            div.className = 'message ' + className;
            div.textContent = text;
            messagesDiv.appendChild(div);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        connect();
    </script>
</body>
</html>